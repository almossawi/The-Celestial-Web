"use strict";var max_orbits=3,skipped=false,delayBetweenTimeTravels=800,populateSummaryBoxDelay=150,bar_transition_speed=200,firefox_constant_x=1250,firefox_constant_y=250,chrome_constant_x=424,chrome_constant_y=360,ie_constant_x=715,ie_constant_y=670,opera_constant_x=1450,opera_constant_y=550;var top_countries=["AR","AT","AU","BR","CA","CH","CN","DE","ES","FR","GB","ID","IN","IT","JP","MX","MY","NK","PH","PL","RU","SE","TR","US","VN"];var browser_colors=["url('#gradient_chrome')","url('#gradient_firefox')","url('#gradient_ie')","url('#gradient_opera')"];var switch_data,myPlayer;var movedThroughTimeJustNow=false,show_all_moons=true,following_a_country=false,following_a_country_iterator=0,show_country_names=false,shaky_shaky_done=true,up_firefox=false,up_chrome=false,up_ie=false,up_opera=false,firefox_count=0,ie_count=0,chrome_count=0,opera_count=0,firefox_top_countries=0,ie_top_countries=0,chrome_top_countries=0,opera_top_countries=0;var countries=[{value:"AF",label:"Afghanistan"},{value:"AX",label:"Ã…land Islands"},{value:"AL",label:"Albania"},{value:"DZ",label:"Algeria"},{value:"AS",label:"American Samoa"},{value:"AD",label:"Andorra"},{value:"AO",label:"Angola"},{value:"AI",label:"Anguilla"},{value:"AQ",label:"Antarctica"},{value:"AG",label:"Antigua and Barbuda"},{value:"AR",label:"Argentina"},{value:"AM",label:"Armenia"},{value:"AW",label:"Aruba"},{value:"AU",label:"Australia"},{value:"AT",label:"Austria"},{value:"AZ",label:"Azerbaijan"},{value:"BS",label:"Bahamas"},{value:"BH",label:"Bahrain"},{value:"BD",label:"Bangladesh"},{value:"BB",label:"Barbados"},{value:"BY",label:"Belarus"},{value:"BE",label:"Belgium"},{value:"BZ",label:"Belize"},{value:"BJ",label:"Benin"},{value:"BM",label:"Bermuda"},{value:"BT",label:"Bhutan"},{value:"BO",label:"Bolivia"},{value:"BA",label:"Bosnia and Herzegovina"},{value:"BW",label:"Botswana"},{value:"BR",label:"Brazil"},{value:"IO",label:"British Indian Ocean Territory"},{value:"BN",label:"Brunei Darussalam"},{value:"BG",label:"Bulgaria"},{value:"BF",label:"Burkina Faso"},{value:"BI",label:"Burundi"},{value:"KH",label:"Cambodia"},{value:"CM",label:"Cameroon"},{value:"CA",label:"Canada"},{value:"CV",label:"Cape Verde"},{value:"KY",label:"Cayman Islands"},{value:"CF",label:"Central African Republic"},{value:"TD",label:"Chad"},{value:"CL",label:"Chile"},{value:"CN",label:"China"},{value:"CO",label:"Colombia"},{value:"KM",label:"Comoros"},{value:"CG",label:"Congo"},{value:"CD",label:"Congo"},{value:"CK",label:"Cook Islands"},{value:"CR",label:"Costa Rica"},{value:"CI",label:"Cote D'ivoire"},{value:"HR",label:"Croatia"},{value:"CU",label:"Cuba"},{value:"CY",label:"Cyprus"},{value:"CZ",label:"Czech Republic"},{value:"DK",label:"Denmark"},{value:"DJ",label:"Djibouti"},{value:"DM",label:"Dominica"},{value:"DO",label:"Dominican Republic"},{value:"EC",label:"Ecuador"},{value:"EG",label:"Egypt"},{value:"SV",label:"El Salvador"},{value:"GQ",label:"Equatorial Guinea"},{value:"ER",label:"Eritrea"},{value:"EE",label:"Estonia"},{value:"ET",label:"Ethiopia"},{value:"FK",label:"Falkland Islands (Malvinas)"},{value:"FO",label:"Faroe Islands"},{value:"FJ",label:"Fiji"},{value:"FI",label:"Finland"},{value:"FR",label:"France"},{value:"GF",label:"French Guiana"},{value:"PF",label:"French Polynesia"},{value:"TF",label:"French Southern Territories"},{value:"GA",label:"Gabon"},{value:"GM",label:"Gambia"},{value:"GE",label:"Georgia"},{value:"DE",label:"Germany"},{value:"GH",label:"Ghana"},{value:"GI",label:"Gibraltar"},{value:"GR",label:"Greece"},{value:"GL",label:"Greenland"},{value:"GD",label:"Grenada"},{value:"GP",label:"Guadeloupe"},{value:"GU",label:"Guam"},{value:"GT",label:"Guatemala"},{value:"GN",label:"Guinea"},{value:"GW",label:"Guinea-bissau"},{value:"GY",label:"Guyana"},{value:"HT",label:"Haiti"},{value:"VA",label:"Holy See (Vatican City State)"},{value:"HN",label:"Honduras"},{value:"HK",label:"Hong Kong"},{value:"HU",label:"Hungary"},{value:"IS",label:"Iceland"},{value:"IN",label:"India"},{value:"ID",label:"Indonesia"},{value:"IR",label:"Iran"},{value:"IQ",label:"Iraq"},{value:"IE",label:"Ireland"},{value:"IM",label:"Isle of Man"},{value:"IL",label:"Israel"},{value:"IT",label:"Italy"},{value:"JM",label:"Jamaica"},{value:"JP",label:"Japan"},{value:"JE",label:"Jersey"},{value:"JO",label:"Jordan"},{value:"KZ",label:"Kazakhstan"},{value:"KE",label:"Kenya"},{value:"KI",label:"Kiribati"},{value:"KP",label:"Korea, DPR"},{value:"KR",label:"Korea, Republic of"},{value:"KW",label:"Kuwait"},{value:"KG",label:"Kyrgyzstan"},{value:"LA",label:"Lao People's Democratic Republic"},{value:"LV",label:"Latvia"},{value:"LB",label:"Lebanon"},{value:"LS",label:"Lesotho"},{value:"LR",label:"Liberia"},{value:"LY",label:"Libya"},{value:"LI",label:"Liechtenstein"},{value:"LT",label:"Lithuania"},{value:"LU",label:"Luxembourg"},{value:"MO",label:"Macao"},{value:"MK",label:"Macedonia"},{value:"MG",label:"Madagascar"},{value:"MW",label:"Malawi"},{value:"MY",label:"Malaysia"},{value:"MV",label:"Maldives"},{value:"ML",label:"Mali"},{value:"MT",label:"Malta"},{value:"MH",label:"Marshall Islands"},{value:"MQ",label:"Martinique"},{value:"MR",label:"Mauritania"},{value:"MU",label:"Mauritius"},{value:"YT",label:"Mayotte"},{value:"MX",label:"Mexico"},{value:"FM",label:"Micronesia"},{value:"MD",label:"Moldova"},{value:"MC",label:"Monaco"},{value:"MN",label:"Mongolia"},{value:"ME",label:"Montenegro"},{value:"MS",label:"Montserrat"},{value:"MA",label:"Morocco"},{value:"MZ",label:"Mozambique"},{value:"MM",label:"Myanmar"},{value:"NA",label:"Namibia"},{value:"NR",label:"Nauru"},{value:"NP",label:"Nepal"},{value:"NL",label:"Netherlands"},{value:"AN",label:"Netherlands Antilles"},{value:"NC",label:"New Caledonia"},{value:"NZ",label:"New Zealand"},{value:"NI",label:"Nicaragua"},{value:"NE",label:"Niger"},{value:"NG",label:"Nigeria"},{value:"NU",label:"Niue"},{value:"NF",label:"Norfolk Island"},{value:"MP",label:"Northern Mariana Islands"},{value:"NO",label:"Norway"},{value:"OM",label:"Oman"},{value:"PK",label:"Pakistan"},{value:"PW",label:"Palau"},{value:"PS",label:"Palestine"},{value:"PA",label:"Panama"},{value:"PY",label:"Paraguay"},{value:"PE",label:"Peru"},{value:"PH",label:"Philippines"},{value:"PL",label:"Poland"},{value:"PT",label:"Portugal"},{value:"PR",label:"Puerto Rico"},{value:"QA",label:"Qatar"},{value:"RE",label:"Reunion"},{value:"RO",label:"Romania"},{value:"RU",label:"Russian Federation"},{value:"RW",label:"Rwanda"},{value:"KN",label:"Saint Kitts and Nevis"},{value:"LC",label:"Saint Lucia"},{value:"PM",label:"Saint Pierre and Miquelon"},{value:"VC",label:"Saint Vincent and The Grenadines"},{value:"WS",label:"Samoa"},{value:"SM",label:"San Marino"},{value:"ST",label:"Sao Tome and Principe"},{value:"SA",label:"Saudi Arabia"},{value:"SN",label:"Senegal"},{value:"RS",label:"Serbia"},{value:"SC",label:"Seychelles"},{value:"SL",label:"Sierra Leone"},{value:"SG",label:"Singapore"},{value:"SK",label:"Slovakia"},{value:"SI",label:"Slovenia"},{value:"SB",label:"Solomon Islands"},{value:"SO",label:"Somalia"},{value:"ZA",label:"South Africa"},{value:"ES",label:"Spain"},{value:"LK",label:"Sri Lanka"},{value:"SD",label:"Sudan"},{value:"SR",label:"Suriname"},{value:"SZ",label:"Swaziland"},{value:"SE",label:"Sweden"},{value:"CH",label:"Switzerland"},{value:"SY",label:"Syrian Arab Republic"},{value:"TW",label:"Taiwan"},{value:"TJ",label:"Tajikistan"},{value:"TZ",label:"Tanzania"},{value:"TH",label:"Thailand"},{value:"TL",label:"Timor-leste"},{value:"TG",label:"Togo"},{value:"TK",label:"Tokelau"},{value:"TO",label:"Tonga"},{value:"TT",label:"Trinidad and Tobago"},{value:"TN",label:"Tunisia"},{value:"TR",label:"Turkey"},{value:"TM",label:"Turkmenistan"},{value:"TC",label:"Turks and Caicos Islands"},{value:"TV",label:"Tuvalu"},{value:"UG",label:"Uganda"},{value:"UA",label:"Ukraine"},{value:"AE",label:"United Arab Emirates"},{value:"GB",label:"United Kingdom"},{value:"US",label:"United States"},{value:"UM",label:"United States Minor Outlying Islands"},{value:"UY",label:"Uruguay"},{value:"UZ",label:"Uzbekistan"},{value:"VU",label:"Vanuatu"},{value:"VE",label:"Venezuela"},{value:"VN",label:"Viet Nam"},{value:"VG",label:"Virgin Islands, British"},{value:"VI",label:"Virgin Islands, U.S."},{value:"WF",label:"Wallis and Futuna"},{value:"YE",label:"Yemen"},{value:"ZM",label:"Zambia"},{value:"ZW",label:"Zimbabwe"}];$(document).ready(function(){if(gup("skip")!="1"){document.getElementById("explosion").volume=0;_V_("bigbang_video").ready(function(){myPlayer=this;myPlayer.options.flash.swf="bigbang.mp4";myPlayer.addEvent("loadstart",function(){$("#and_then").show()});myPlayer.addEvent("loadeddata",function(){$("#and_then").show(0,function(){d3.selectAll(".intro_circle").each(function(e,c){d3.select(this).transition().delay(c*700).duration(300).attr("fill",function(){return browser_colors[c]})})}).delay(2300).fadeOut("slow",function(){$("#dim").css("opacity","0.7").hide();$("#video_container").css("opacity",1);setTimeout(function(){if(skipped==false){document.getElementById("explosion").play()}},3200);myPlayer.play()})});myPlayer.addEvent("timeupdate",function(){if(myPlayer.currentTime()>13){$("#video_container").fadeOut(2000)}});$("#skip").on("click",function(){$("#video_container").fadeOut();$("#dim").fadeOut();$("#and_then").hide();myPlayer.pause();skipped=true})})}else{$("#dim").css("opacity","0.7").hide();$("#video_container").hide()}$("#hear_it").on("click",function(){document.getElementById("explosion").volume=1;$("#hear_it").css("color","#4eff00")});$("#country").autocomplete({appendTo:"#modal_box2",source:countries,delay:150,focus:function(c,d){$("#country").val(d.item.label);return false},select:function(c,d){$("#selected_country").val(d.item.label);$("#selected_country_id").val(d.item.value);return false},});$("#summary_chart").attr("transform","translate(0,40)");$("#slider-vertical_zoomin").on("click",function(){var c=$("#slider-vertical").slider("value");c=(c<5)?c+1:5;$("#slider-vertical").slider("value",c)});$("#slider-vertical_zoomout").on("click",function(){var c=$("#slider-vertical").slider("value");c=(c>1)?c-1:1;$("#slider-vertical").slider("value",c)});$("#slider-vertical").slider({orientation:"vertical",range:"min",min:1,max:5,value:3,slide:function(c,d){handleZoomSlider(c,d.value)},change:function(c,d){handleZoomSlider(c,d.value)}});$("#socialmedia").on("mouseenter",function(){$("#socialmedia span").fadeOut("fast");$("#sm_buttons").hide().css("right","0px").fadeIn("fast")});$("#sm_buttons").on("mouseleave",function(){$("#socialmedia span").fadeIn("fast");$("#sm_buttons").fadeOut("fast").css("right","-300px")});wobble_firefox();wobble_chrome();wobble_ie();wobble_opera();$("#show_all_moons").toggle(function(c){show_all_moons=false;$(".market").css("display","none");$("#show_all_moons .icon").css("background-image","url('images/checked_all.png')");$("#show_all_moons .label").html("Show all countries")},function(){show_all_moons=true;$(".market, .top_market").css("display","block");$("#show_all_moons .icon").css("background-image","url('images/checked_top.png')");$("#show_all_moons .label").html("Show accented countries")});$("#show_country_names").toggle(function(c){show_country_names=true;$("#show_country_names").html("Hide country names");showOnlyCountryNames()},function(){show_country_names=false;$("#show_country_names").html("Show country names");showOnlyMoons()});$(".cat-button:not(.ui-state-disabled)").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}).mousedown(function(){$(this).parents(".cat-buttonset-single:first").find(".cat-button.ui-state-active").removeClass("ui-state-active");if($(this).is(".ui-state-active.cat-button-toggleable, .cat-buttonset-multi .ui-state-active")){$(this).removeClass("ui-state-active")}else{$(this).addClass("ui-state-active")}}).mouseup(function(){if(!$(this).is(".cat-button-toggleable, .cat-buttonset-single .cat-button,  .cat-buttonset-multi .cat-button")){$(this).removeClass("ui-state-active")}});$("#play_pause").toggle(function(d){var c=document.getElementById("audio").currentTime;document.getElementById("audio").play();$("#play_pause_icon").attr("src","images/audio_playing.png");document.getElementById("audio").play();document.getElementById("audio").volume=1},function(){$("#play_pause_icon").attr("src","images/audio_paused.png");$("audio").volumizer([600,0.0001]);setTimeout(function(){},900)});$("#prev_date").on("click",function(c){left(c)});$("#next_date").on("click",function(c){right(c)});$("#jump_to_date_link").on("click",function(){$("#dim").show();$("#modal_box").show();$("#modal_box #date_field").val("");$("#modal_box .error").stop().html("");$("#modal_box #date_field").focus();return false});$("#pause_play_moons_animation").toggle(function(c){$("#pause_play_moons_animation img").attr("src","images/play.png");d3.selectAll(".animo").attr("calcMode","discrete").attr("keyPoints","0").attr("keyTimes","0")},function(){$("#pause_play_moons_animation img").attr("src","images/pause.png");d3.selectAll(".animo").attr("calcMode","paced").attr("keyPoints","0").attr("keyTimes","0")});$("#follow_a_country").on("click",function(){if($("#follow_a_country .label").html()!="Follow a country"){following_a_country=false;$("#selected_country").val("");$("#selected_country_id").val("");$("#follow_a_country .label").html("Follow a country");$(".market, .top_market").show();$("#arbitrary_msg_box").hide();$("#next_date").show();$("#prev_date").show();$("#show_all_moons").removeAttr("disabled");$("#show_all_moons").css("background-color","#4e4e4e");$("#show_all_moons").css("border-color","#4e4e4e");$("#show_all_moons").css("color","#fff");return false}$("#dim").show();$("#modal_box2").show();$("#modal_box2 #country").val("");$("#modal_box2 .error").stop().html("");$("#modal_box2 #country").focus();return false});$("#trends_link").toggle(function(c){if($("#content").is(":hidden")==false){$("#content").hide();return}$("#content").show();return false},function(){if($("#content").is(":hidden")){$("#content").show();return}$("#content").hide();return false});$(".x a").on("click",function(){$("#content").hide();return false});$("body").bind("keydown",function(h){var g=(h.keyCode?h.keyCode:h.which);if(g==37&&($("#modal_box").is(":hidden")==true&&$("#modal_box2").is(":hidden")==true)){left(h);return false}else{if(g==39&&($("#modal_box").is(":hidden")==true&&$("#modal_box2").is(":hidden")==true)){right(h);return false}else{if(g==74&&($("#modal_box").is(":hidden")==true&&$("#modal_box2").is(":hidden")==true)){$("#dim").show();$("#modal_box").show();$("#modal_box #date_field").val("");$("#modal_box .error").stop().html("");$("#modal_box #date_field").focus();return false}else{if(g==70&&($("#modal_box").is(":hidden")==true&&$("#modal_box2").is(":hidden")==true)){$("#dim").show();$("#modal_box2").show();$("#modal_box2 #country").val("");$("#modal_box2 .error").stop().html("");$("#modal_box2 #country").focus();return false}else{if(g==27&&($("#modal_box").is(":hidden")==false||$("#modal_box2").is(":hidden")==false)){$("#dim").hide();$("#modal_box").hide();$("#modal_box2").hide();$("#modal_box #date_field").blur();$("#modal_box2 #country").blur();$("#modal_box2 #country").autocomplete("close");return false}else{if(g==13&&$("#modal_box #date_field").is(":hidden")==false){try{if(Date.parse($("#modal_box #date_field").val()).isBefore(Date.parse("July 2008"))||Date.parse($("#modal_box #date_field").val()).isAfter(Date.today().add(-1).months())){$("#modal_box .error").html("we only have data between July 2008 and last month :-)").show();setTimeout(function(){$("#modal_box .error").fadeOut()},5000);return}jumpToDate(Date.parse($("#modal_box #date_field").val()));$("#dim").hide();$("#modal_box").hide();$("#modal_box #date_field").blur()}catch(f){$("#modal_box .error").html("either that's not a valid date, or...yeah, it's probably just not a valid date.").show();setTimeout(function(){$("#modal_box .error").fadeOut()},5000)}finally{return false}}else{if(g==13&&$("#modal_box2 #country").is(":hidden")==false){try{if($("#selected_country_id").val()!=""&&switch_data[$("#selected_country_id").val()].dates.length-1==0){$("#arbitrary_msg_box").html("Since July 2008, most users in "+$("#selected_country").val()+" have been <br />using the same browser.").show();$("#next_date").hide();$("#prev_date").hide()}else{$("#next_date").show();$("#prev_date").show();$("#arbitrary_msg_box").html("Since July 2008, the majority market share in "+$("#selected_country").val()+" <br />has switched "+(switch_data[$("#selected_country_id").val()].dates.length-1)+" time(s); move left and right to see them.").show();var i=Date.parse("July 2008").toString("MMM yyyy");var c=Date.parse("July 2008").toString("MMMM yyyy");$("#current_date_top_right").html(i);d3.select("#current_date_top_left").text(c);updateData()}followCountry();$("#dim").hide();$("#modal_box2").hide();$("#modal_box2 #country").blur();$("#modal_box2 #country").autocomplete("close")}catch(f){$("#modal_box2 .error").html("hmm...did you select a country from the list on the left?").show();setTimeout(function(){$("#modal_box2 .error").fadeOut()},3000);return}$("#show_all_moons").attr("disabled","disabled");$("#show_all_moons").css("background-color","#262626");$("#show_all_moons").css("border-color","#262626");$("#show_all_moons").css("color","#535353")}}}}}}}});$("#dim").on("click",function(c){$("#dim").hide();$("#modal_box").hide();$("#modal_box2").hide();$("#modal_box #date_field").blur();$("#modal_box #country").blur()});var b=Date.today().add(-1).months().toString("MMM yyyy");var a=Date.today().add(-1).months().toString("MMMM yyyy");$("#current_date_top_right").html(b);d3.select("#current_date_top_left").text(a);drawPlanets(["firefox","ie","chrome","opera"]);updateData();setSwitchData()});function setSwitchData(){d3.json("data/switches.json",function(a){switch_data=a})}function followCountry(){following_a_country_iterator=0;$("#follow_a_country .label").html("Stop following "+$("#selected_country_id").val());if($("#current_date_top_left").text()=="July 2008"||$("#current_date_top_left").text()=="August 2008"){d3.select("#chrome_planet .planet").transition().duration(500).attr("r",0);d3.select("#chrome_planet text").attr("opacity",0)}else{d3.select("#chrome_planet .planet").transition().duration(500).attr("r",50);d3.select("#chrome_planet text").attr("opacity",1)}following_a_country=true;var a=$("#selected_country_id").val();$(".market, .top_market").show();$(".market:not(#"+a+"), .top_market:not(#"+a+")").hide()}function handleZoomSlider(a,b){if(b==1){d3.select("svg").transition().duration(700).attr("viewBox","0 100 2200 1200");$("#plane_container").css("width","1400").css("height","400")}else{if(b==2){d3.select("svg").transition().duration(700).attr("viewBox","0 100 2000 1000");$("#plane_container").css("width","1600").css("height","600")}else{if(b==3){d3.select("svg").transition().duration(700).attr("viewBox","0 100 1800 800");$("#plane_container").css("width","1800").css("height","800")}else{if(b==4){d3.select("svg").transition().duration(700).attr("viewBox","0 100 1600 600");$("#plane_container").css("width","2000").css("height","1000")}else{if(b==5){d3.select("svg").transition().duration(700).attr("viewBox","0 100 1400 400");$("#plane_container").css("width","2000").css("height","1000")}}}}}}function showOnlyCountryNames(){$(".market text, .top_market text").css("display","block");$(".market .moon, .top_market .moon").css("display","none")}function showOnlyMoons(){$(".market text, .top_market text").css("display","none");$(".market .moon, .top_market .moon").css("display","block")}function drawPlanets(planets){$.each(planets,function(index,browser){var g=d3.select("svg").append("g").attr("transform","translate("+eval(browser+"_constant_x")+","+eval(browser+"_constant_y")+")").attr("class","planet").attr("id",browser+"_planet");g.append("circle").attr("r",50).attr("transform","translate(-20,-20)").attr("filter","url(#dropshadow)").attr("fill",function(){return"url(#gradient_"+browser+")"}).attr("class","planet");g.append("text").text(function(){if(browser=="ie"){return"Internet Explorer"}else{if(browser=="opera"){return"Opera"}else{if(browser=="chrome"){return"Chrome"}else{if(browser=="firefox"){return"Firefox"}else{return browser}}}}}).attr("text-anchor","middle").attr("transform","translate(-10,-100)").attr("x",-8).attr("y",5)})}function updateData(){var a=Date.parse($(".current_date").html()).toString("MM");var b=Date.parse($(".current_date").html()).toString("yyyy");processData(a,b)}function jumpToDate(b){var c=Date.parse(b).toString("MMM yyyy");var a=Date.parse(b).toString("MMMM yyyy");$(".current_date").html(c);d3.select("#current_date_top_left").text(a);if(a=="July 2008"||a=="August 2008"){d3.select("#chrome_planet .planet").transition().duration(500).attr("r",0);d3.select("#chrome_planet text").attr("opacity",0)}else{d3.select("#chrome_planet .planet").transition().duration(500).attr("r",50);d3.select("#chrome_planet text").attr("opacity",1)}updateData()}function left(f){if(!movedThroughTimeJustNow){movedThroughTimeJustNow=true;setTimeout("movedThroughTimeJustNow = false",delayBetweenTimeTravels)}else{f.preventDefault();return}if($("#selected_country_id").val()!=""&&switch_data[$("#selected_country_id").val()].dates.length-1==0){return}if($("#current_date_top_right").html()=="Jul 2008"){if(shaky_shaky_done){shaky_shaky_done=false;$("#current_date_top_right").effect("shake",{times:2,distance:3},10,function(){shaky_shaky_done=true})}return}if(following_a_country==true){var b;if(following_a_country_iterator==0){b=0}else{b=--following_a_country_iterator}var c=switch_data[$("#selected_country_id").val()].dates[b];var g=Date.parse(c).toString("MMM yyyy");var a=Date.parse(c).toString("MMMM yyyy");$("#current_date_top_right").html(g);d3.select("#current_date_top_left").text(a)}else{var g=Date.parse($(".current_date").html()).add(-1).month().toString("MMM yyyy");var a=Date.parse($(".current_date").html()).add(-1).month().toString("MMMM yyyy");$(".current_date").html(g);d3.select("#current_date_top_left").text(a)}if($("#current_date_top_left").text()=="July 2008"||$("#current_date_top_left").text()=="August 2008"){d3.select("#chrome_planet .planet").transition().duration(500).attr("r",0);d3.select("#chrome_planet text").attr("opacity",0)}else{d3.select("#chrome_planet .planet").transition().duration(500).attr("r",50);d3.select("#chrome_planet text").attr("opacity",1)}updateData()}function right(g){if(!movedThroughTimeJustNow){movedThroughTimeJustNow=true;setTimeout("movedThroughTimeJustNow = false",delayBetweenTimeTravels)}else{g.preventDefault();return}if($("#selected_country_id").val()!=""&&switch_data[$("#selected_country_id").val()].dates.length-1==0){return}var a=Date.today().add(-1).months().toString("MMM yyyy");if($("#current_date_top_right").html()==a){if(shaky_shaky_done){shaky_shaky_done=false;$("#current_date_top_right").effect("shake",{times:2,distance:3},10,function(){shaky_shaky_done=true})}return}if(following_a_country==true){var f;if(following_a_country_iterator==switch_data[$("#selected_country_id").val()].dates.length-1){if(shaky_shaky_done){shaky_shaky_done=false;$("#current_date_top_right").effect("shake",{times:2,distance:3},10,function(){shaky_shaky_done=true})}return}else{f=++following_a_country_iterator}var c=switch_data[$("#selected_country_id").val()].dates[f];var h=Date.parse(c).toString("MMM yyyy");var b=Date.parse(c).toString("MMMM yyyy");$("#current_date_top_right").html(h);d3.select("#current_date_top_left").text(b)}else{var h=Date.parse($("#current_date_top_right").html()).add(1).month().toString("MMM yyyy");var b=Date.parse($(".current_date").html()).add(1).month().toString("MMMM yyyy");$("#current_date_top_right").html(h);d3.select("#current_date_top_left").text(b)}if($("#current_date_top_left").text()=="July 2008"||$("#current_date_top_left").text()=="August 2008"){d3.select("#chrome_planet .planet").transition().duration(500).attr("r",0);d3.select("#chrome_planet text").attr("opacity",0)}else{d3.select("#chrome_planet .planet").transition().duration(500).attr("r",50);d3.select("#chrome_planet text").attr("opacity",1)}updateData()}function processData(b,a){firefox_count=0,ie_count=0,chrome_count=0,opera_count=0,firefox_top_countries=0,ie_top_countries=0,chrome_top_countries=0,opera_top_countries=0;d3.json("data/"+a+"-"+b+".json",function(c){firefox_count=(c.firefox)?c.firefox.length:"";ie_count=(c.ie)?c.ie.length:"";chrome_count=(c.chrome)?c.chrome.length:"";opera_count=(c.opera)?c.opera.length:"";populateCounts(c);setTimeout(populateSummaryBox,populateSummaryBoxDelay);buildMoons(c,["firefox","ie","chrome","opera"])})}function isTopMarketFirefox(a){if($.inArray(a,top_countries)!=-1){firefox_top_countries++}}function isTopMarketChrome(a){if($.inArray(a,top_countries)!=-1){chrome_top_countries++}}function isTopMarketIe(a){if($.inArray(a,top_countries)!=-1){ie_top_countries++}}function isTopMarketOpera(a){if($.inArray(a,top_countries)!=-1){opera_top_countries++}}function populateCounts(a){if(a.firefox!=undefined){$.map(a.firefox,isTopMarketFirefox)}if(a.chrome!=undefined){a.chrome.map(isTopMarketChrome)}if(a.ie!=undefined){a.ie.map(isTopMarketIe)}if(a.opera!=undefined){a.opera.map(isTopMarketOpera)}}function populateSummaryBox(){var a=d3.select("#summary_chart");d3.select("#firefox_plurality").transition().duration(bar_transition_speed).attr("width",function(){return firefox_count*2});d3.select("#firefox_top_markets_plurality").transition().duration(bar_transition_speed).attr("width",function(){return firefox_top_countries*2});d3.select("#firefox_plurality_text").transition().duration(bar_transition_speed).text(function(){return firefox_count}).attr("x",function(){return 106+firefox_count*2});d3.select("#firefox_top_markets_plurality_text").transition().duration(bar_transition_speed).text(function(){return(firefox_top_countries==0)?"":firefox_top_countries}).attr("x",function(){return 102+firefox_top_countries*2});d3.select("#chrome_plurality").transition().duration(bar_transition_speed).attr("width",function(){return chrome_count*2});d3.select("#chrome_top_markets_plurality").transition().duration(bar_transition_speed).attr("width",function(){return chrome_top_countries*2});d3.select("#chrome_plurality_text").transition().duration(bar_transition_speed).text(function(){return chrome_count}).attr("x",function(){return 106+chrome_count*2});d3.select("#chrome_top_markets_plurality_text").transition().duration(bar_transition_speed).text(function(){return(chrome_top_countries==0)?"":chrome_top_countries}).attr("x",function(){return 102+chrome_top_countries*2});d3.select("#ie_plurality").transition().duration(bar_transition_speed).attr("width",function(){return ie_count*2});d3.select("#ie_top_markets_plurality").transition().duration(bar_transition_speed).attr("width",function(){return ie_top_countries*2});d3.select("#ie_plurality_text").transition().duration(bar_transition_speed).text(function(){return ie_count}).attr("x",function(){return 106+ie_count*2});d3.select("#ie_top_markets_plurality_text").transition().duration(bar_transition_speed).text(function(){return(ie_top_countries==0)?"":ie_top_countries}).attr("x",function(){return 102+ie_top_countries*2});d3.select("#opera_plurality").transition().duration(bar_transition_speed).attr("width",function(){return opera_count*2});d3.select("#opera_top_markets_plurality").transition().duration(bar_transition_speed).attr("width",function(){return opera_top_countries*2});d3.select("#opera_plurality_text").transition().duration(bar_transition_speed).text(function(){return opera_count}).attr("x",function(){return 106+opera_count*2});d3.select("#opera_top_markets_plurality_text").transition().duration(bar_transition_speed).text(function(){return(opera_top_countries==0)?"":opera_top_countries}).attr("x",function(){return 102+opera_top_countries*2})}function buildMoons(a,b){removeCurrentMoons(addNewMoons,a,b)}function removeCurrentMoons(a,b,c){d3.selectAll(".market,.top_market").transition().duration(400).attr("r",0).style("opacity",0).remove();if(typeof a==="function"){setTimeout(function(){a(b,c)},600)}}function addNewMoons(data,planets){d3.selectAll("path").remove();$.each(planets,function(index,browser){for(var i=1;i<=eval(browser+"_count");i++){if(i<=max_orbits){d3.select("#"+browser+"_system").append("path").attr("id",browser+"_path"+i).attr("d","M"+(eval(browser+"_constant_x")+i*100)+","+eval(browser+"_constant_y")+" h 0 a"+(30+i*100)+","+(9+i*30)+" 0 1,0 1,1 z").attr("fill","none")}var g=d3.select("#"+browser+"_system").append("g").attr("class",function(){if($.inArray(data[browser][i-1],top_countries)!=-1){return"top_market"}else{return"market"}}).attr("id",function(){return data[browser][i-1]});g.append("circle").style("opacity",0).attr("r",0).attr("fill","url('#gradient_white')").attr("class","moon");g.append("text").text(data[browser][i-1]).attr("x",-8).attr("y",5);g.append("animateMotion").attr("class","animo").attr("dur",function(){if(following_a_country==true&&data[browser][i-1]==$("#selected_country_id").val()){return"20s"}else{return(18+i)+"s"}}).attr("repeatCount","indefinite").append("mpath").attr("xlink:href",function(){if($.inArray(data[browser][i-1],top_countries)!=-1){var biggest_orbit=(eval(browser+"_count")<max_orbits)?eval(browser+"_count"):max_orbits;return"#"+browser+"_path"+biggest_orbit}else{if(following_a_country==true&&data[browser][i-1]==$("#selected_country_id").val()){var biggest_orbit=(eval(browser+"_count")<max_orbits)?eval(browser+"_count"):max_orbits;return"#"+browser+"_path"+biggest_orbit}else{if(i<=max_orbits){return"#"+browser+"_path"+i}else{return"#"+browser+"_path"+randomRange(1,max_orbits)}}}})}});d3.selectAll(".top_market .moon").attr("fill","url('#gradient_red')");if(show_country_names==true){showOnlyCountryNames()}if(show_all_moons==false&&following_a_country==false){$(".market").hide()}if(following_a_country==true){$(".market:not(#"+$("#selected_country_id").val()+"), .top_market:not(#"+$("#selected_country_id").val()+")").hide()}d3.selectAll(".moon").transition().duration(500).style("opacity",1).attr("r",5)}function wobble_firefox(){var a;if(up_firefox){up_firefox=false;a=-6}else{up_firefox=true;a=6}d3.select("#firefox_system").transition().ease("cubic-in-out").duration(12000).attr("transform","rotate("+a+","+firefox_constant_x+","+firefox_constant_y+")").each("end",wobble_firefox)}function wobble_chrome(){var a;if(up_chrome){up_chrome=false;a=-5}else{up_chrome=true;a=5}d3.select("#chrome_system").transition().ease("cubic-in-out").duration(11000).attr("transform","rotate("+a+","+chrome_constant_x+","+chrome_constant_y+")").each("end",wobble_chrome)}function wobble_ie(){var a;if(up_ie){up_ie=false;a=-6}else{up_ie=true;a=6}d3.select("#ie_system").transition().ease("cubic-in-out").duration(10000).attr("transform","rotate("+a+","+ie_constant_x+","+ie_constant_y+")").each("end",wobble_ie)}function wobble_opera(){var a;if(up_opera){up_opera=false;a=-6}else{up_opera=true;a=6}d3.select("#opera_system").transition().ease("cubic-in-out").duration(13000).attr("transform","rotate("+a+","+opera_constant_x+","+opera_constant_y+")").each("end",wobble_opera)}$.fn.volumizer=function(a){return this.each(function(){var d=-1,i=this;var h=a,e=a[0],f=this.volume,g=h[1]*f,b=(g-f)/e;for(var c=0;c<e+1;c++){(function(j){setTimeout(function(){i.volume=j},c)})(f+(b*c))}})};function randomRange(b,d,a){var c=b+(Math.random()*(d-b));return typeof a=="undefined"?Math.round(c):c.toFixed(a)}function gup(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a="[\\#&]"+b+"=([^&#]*)";var d=new RegExp(a);var c=d.exec(window.location.href);if(c==null){return""}else{return c[1]}};